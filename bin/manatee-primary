#!/bin/bash
# Promote this current node to the primary of the shard.

set -o errexit
set -o pipefail

echo 'WARNING: Forcibly promoting this node to primary. If used incorrectly you WILL lose data.'
echo 'Ensure there are no other manatees running in the shard via manatee-stat'
echo 'Type MANATEE to continue(N/y)'

read input

if [[ $input == 'MANATEE' ]]; then
    echo 'disabling manatee-sitter'
    svcadm disable manatee-sitter
    echo 'removing sync state cookie'
    rm -rf /var/tmp/manatee_sync_state
    echo 'enabling manatee-sitter'
    svcadm enable manatee-sitter
else
    exit 'Not promoting manatee, exiting'
fi

